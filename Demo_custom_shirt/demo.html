<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script
        src="https://unpkg.com/aframe-environment-component@1.3.2/dist/aframe-environment-component.min.js"></script>
    <script src="https://unpkg.com/aframe-orbit-controls@1.3.0/dist/aframe-orbit-controls.min.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@5.0.0/dist/aframe-event-set-component.js"></script>

</head>

<body>
    <div style="width: 80vw; height: 80vh; position: relative;">
        <div class="menu-customize" style="position: absolute; width: 200px; height: 100%; z-index: 2; opacity: 0.5;">
            <ul>
                <h3>Danh sách các mesh trong obj</h3>
                <div id="menuShow">

                </div>
                <li><button id="tomau" type="button">tô màu</button></li>
                <li><button type="button">tô màu file ảnh</button></li>
                <li><button type="button">dán hình</button></li>
                <li><button id="back" type="button">back</button></li>
            </ul>
        </div>
        <a-scene style="width: 100%; height: 100%;" embedded environment="preset: forest" vr-mode-ui="enabled: false"
            ar-mode-ui="enabled: true">

            <a-light type="ambient" color="white" target="#model">
                <a-gltf-model id="model" src="./first_clothing_item.glb" shadow position="0 1.6 -0.5">
                </a-gltf-model>
            </a-light>
            <!-- <a-image src="./assets/image/logo.png" shadow position="0 1.6 0.1" side="double"></a-image> -->

            <a-entity camera look-controls="enabled: false"
                orbit-controls="target: 0 1.6 -0.5; minDistance: 0.5; maxDistance: 20; initialPosition: 0 2 0.1; rotateSpeed: 0.5">
            </a-entity>


        </a-scene>
    </div>


    <script>
        function getRandomColor(e) {
            var letters = '0123456789ABCDEF';
            var color = '#';
            for (var i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }
    </script>
    <script>
        var originalMaterials = [];
        var lengthOM = 0;


        const model = document.querySelector('#model');

        function elmClick(btn, uuid) {
            const obj3d = model.getObject3D('mesh');
            obj3d.traverse(node => {
                if (node.isMesh && node.uuid == uuid) {
                    node.material.color.set(btn.style.backgroundColor);
                }
            });
        }

        const back = document.querySelector('#back');
        back.addEventListener('click', () => {
            const obj3d = model.getObject3D('mesh');
            if (originalMaterials.length > lengthOM) {
                const node2 = originalMaterials.pop();
                obj3d.traverse(node => {
                    if (node2.uuid == node.uuid) {
                        node.material = node2.nodeMaterial;
                    }
                });
            }
            else {
                console.log(originalMaterials)
                obj3d.traverse(node => {
                    if (node.isMesh) {
                        let n = originalMaterials.find(item => item.uuid == node.uuid);
                        node.material = n.nodeMaterial;
                        node.material.color = n.material.color;
                    }
                })
            }
        });

        const menuShow = document.querySelector('#menuShow');
        model.addEventListener('model-loaded', () => {
            menuShow.innerHTML = "";

            const obj3d = model.getObject3D('mesh');
            obj3d.traverse(node => {
                if (node.isMesh) {
                    lengthOM = lengthOM + 1;
                    originalMaterials.push({ uuid: node.uuid, nodeMaterial: node.material, color: node.material.color });
                    menuShow.insertAdjacentHTML('beforeend', `<button style="background-color: ${getRandomColor()}" onclick="elmClick(this,'${node.uuid}')" type="button">${node.name}</button>`)
                }
            });
            console.log(originalMaterials)
        });





        const tomau = document.querySelector('#tomau');

        tomau.addEventListener('click', () => {
            const obj3d = model.getObject3D('mesh');
            obj3d.traverse(node => {
                if (node.isMesh) {
                    console.log(node.material)
                    node.material.color.set('green');
                }
            });
        });

        var textureLoader = new THREE.TextureLoader();
        textureLoader.load('./me.jpg', function (texture) {

        });
    </script>

</body>

</html>